<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cycle Sort Visualizer with Pointers</title>
  <style>
    body {
      background: #111827;
      color: #f3f4f6;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
    }
    #main {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 38px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    #visualizer, #codebox {
      background: #21273a;
      border-radius: 12px;
      padding: 26px 18px 18px 18px;
      box-shadow: 0 4px 24px #0003;
    }
    #visualizer {
      width: 610px;
      min-width: 350px;
    }
    #array {
      display: flex;
      align-items: flex-end;
      height: 180px;
      margin: 28px 0 8px 0;
      background: #181e2b;
      border-radius: 10px;
      transition: background 0.3s;
      position: relative;
    }
    .bar {
      flex: 1;
      margin: 0 3px;
      background: linear-gradient(180deg,#22d3ee 0%, #1d4ed8 100%);
      border-radius: 5px 5px 0 0;
      position: relative;
      min-width: 16px;
      transition: background 0.3s, height 0.35s cubic-bezier(.34,1.56,.64,1), box-shadow 0.30s;
      box-shadow: 0 2px 8px #0ef2;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }
    .bar .value {
      position: absolute;
      bottom: 7px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      color: #fff;
      font-weight: bold;
      z-index: 2;
      pointer-events: none;
      letter-spacing: .5px;
      background: rgba(32,36,64,0.22);
      padding: 2px 6px;
      border-radius: 6px;
      user-select: none;
    }
    /* Pointer styles with distinct colors */
    .bar.current {
      background: linear-gradient(180deg,#fbbf24 10%,#fb923c 90%);
      box-shadow: 0 2px 14px #fdae1b88;
    }
    .bar.scanning {
      background: linear-gradient(180deg,#f43f5e 10%,#a21caf 90%);
      box-shadow: 0 2px 14px #f43f5eaa;
    }
    .bar.pos {
      background: linear-gradient(180deg,#34d399 10%,#059669 90%);
      box-shadow: 0 2px 14px #059669cc;
    }
    .bar.placed {
      background: linear-gradient(180deg,#9EDD7D 10%,#2fa94e 90%);
      box-shadow: 0 2px 16px #77df6a66;
    }

    /* Pointer labels */
    .pointers {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      font-weight: 800;
      white-space: nowrap;
      z-index: 10;
      letter-spacing: 0.5px;
      display: flex;
      gap: 5px;
      user-select: none;
    }
    .pointers span {
      margin: 0 2px;
      padding: 2px 7px;
      border-radius: 5px;
      font-size: 13px;
      border: 1.4px solid;
      box-shadow: 0 1px 6px #0008;
      cursor: default;
    }
    .pointers .current {
      background: #fbbf24;
      color: #542e00;
      border-color: #b45309;
      box-shadow: 0 1px 8px #b4530922;
    }
    .pointers .scanning {
      background: #dc2626;
      color: #fff9f7;
      border-color: #b91c1c;
      box-shadow: 0 1px 8px #b91c1c99;
    }
    .pointers .pos {
      background: #059669;
      color: #d1fae5;
      border-color: #047857;
      box-shadow: 0 1px 8px #047857aa;
    }

    #explanation {
      margin-top: 18px;
      font-size: 18px;
      color: #a7ffeb;
      min-height: 36px;
      font-family: 'Fira Mono', monospace;
      text-shadow: 0 1px 8px #096c5e32;
      letter-spacing: .5px;
      transition: color 0.2s;
      user-select: none;
    }
    #controls {
      margin-top: 8px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    #controls label,
    #controls input[type=range] {
      margin-bottom: 0;
      font-size: 15.5px;
    }
    #controls button,
    #controls input[type=range] {
      padding: 6.5px 13px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background: #374151;
      color: #fff;
      cursor: pointer;
      transition: background 0.17s, color 0.17s, box-shadow 0.18s;
      box-shadow: 0 2px 4px #0002;
      user-select: none;
    }
    #controls button:hover {
      background: #0ea5e9;
      color: #fff;
      box-shadow: 0 4px 15px #49e9fa57;
    }
    #controls input[type=range] {
      accent-color: #3b82f6;
      background: #27273c;
      border-radius: 5px;
      margin-left: 8px;
      width: 90px;
      height: 4px;
    }
    #inputbox {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
    }
    #inputbox input {
      width: 156px;
      padding: 7px 8px;
      border-radius: 5px;
      border: 1.2px solid #1251b0;
      font-size: 15px;
      margin-right: 5px;
      background: #20243d;
      color: #c1d1fb;
      outline: none;
      transition: border 0.16s;
    }
    #inputbox input:focus {
      border-color: #22d3ee;
      background: #181d37;
    }
    #inputbox button {
      padding: 7px 13px;
      font-size: 15px;
      border-radius: 5px;
      background: #1847a3;
      color: #eee;
      border: none;
      cursor: pointer;
      transition: background 0.17s;
    }
    #inputbox button:hover {
      background: #2563eb;
    }
    #codebox {
      min-width: 320px;
      max-width: 500px;
      margin-top: 12px;
    }
    #codebox strong {
      font-size: 17.5px;
      color: #93e7fc;
      letter-spacing: 0.5px;
    }
    pre {
      margin: 0;
      padding-top: 5px;
      font-family: 'Fira Mono', 'Consolas', 'monospace';
      font-size: 16px;
      line-height: 1.65;
      color: #e0e7ef;
      background: none;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-x: auto;
      max-width: 100%;
    }
    .codeline {
      display: block;
      padding: 0 8px;
      border-radius: 6px;
      transition: background 0.19s;
      white-space: pre-wrap !important;
    }
    .highlight {
      background: #155ab5;
      color: #ffeebd;
    }
    a {
      color: #93e7fc;
      text-decoration: none;
      font-size: 16px;
      padding-left: 14px;
    }
    #purecodebox {
      background: #232c4d;
      margin: 42px auto 44px auto;
      border-radius: 13px;
      max-width: 1000px;
      padding: 26px 23px 17px 23px;
      box-shadow: 0 8px 32px #0ecdee20;
      border: 1.8px solid #0f466b28;
    }
    #purecodebox strong {
      font-size: 20px;
      font-weight: 700;
      color: #93e7fc;
      display: block;
      margin-bottom: 12px;
      letter-spacing: .3px;
    }
    .codes-list {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      justify-content: flex-start;
    }
    .codes-list pre {
      font-size: 13.7px;
      background: #191e2b;
      border-radius: 7px;
      padding: 14px 12px 12px 12px;
      margin: 7px 0 0 0;
      min-width: 190px;
      max-width: 100%;
      border: 1.2px solid #2d3b54;
      color: #b0e0fa;
      overflow-x: auto;
    }
    .codes-list .lang {
      font-size: 15.5px;
      margin-bottom: 4px;
      color: #93e7fc;
      letter-spacing: 0.2px;
    }
    .codes-row {
      display: flex;
      gap: 36px;
      margin-bottom: 16px;
    }
    .codes-row > div {
      flex: 1 1 0;
      min-width: 180px;
      max-width: 100%;
    }
    @media only screen and (max-width: 1000px) {
      #main {
        flex-direction: column;
        gap: 16px;
      }
      #visualizer {
        width: 95vw;
        min-width: 0;
      }
      #codebox {
        max-width: 100vw;
      }
    }
    @media (max-width: 720px) {
      .codes-row {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
<a href="index.html">← Back to main index</a>
<div id="main">
  <div id="visualizer">
    <div id="controls">
      <button onclick="resetArray()">Reset</button>
      <button onclick="start()">▶ Play</button>
      <button onclick="pause()">⏸ Pause</button>
      <button onclick="stepToStart()">|⏮ Start</button>
      <button onclick="prevStep()">⏮ Back</button>
      <button onclick="nextStep()">⏭ Next</button>
      <button onclick="stepToEnd()">End ⏭|</button>
      <label>Speed:
        <input id="speedSlider" type="range" min="30" max="600" value="140" />
      </label>
    </div>
    <div id="inputbox">
      <label for="arrayInput">Custom array: </label>
      <input type="text" id="arrayInput" placeholder="e.g. 23,14,88,11,77" />
      <button onclick="useCustomArray()">Use Custom Array</button>
    </div>
    <div id="array"></div>
    <div class="pointers" id="pointerLabels" style="pointer-events:none;"></div>
    <div id="explanation"></div>
  </div>
  <div id="codebox">
    <strong>Cycle Sort <span style="font-size:13px; color:#999; font-weight:normal">(JS visualized with highlighting)</span></strong>
    <pre id="codearea"></pre>
  </div>
</div>

<div id="purecodebox">
  <strong>Pure Cycle Sort in Java / C++ / Python / JavaScript</strong>
  <div class="codes-list">
    <div class="codes-row">
      <div>
        <div class="lang">Java</div>
        <pre>
public static void cycleSort(int[] arr) {
  int n = arr.length;
  for (int cs = 0; cs < n - 1; cs++) {
    int item = arr[cs], pos = cs;
    for (int i = cs + 1; i < n; i++)
      if (arr[i] < item) pos++;
    if (pos == cs) continue;
    while (item == arr[pos]) pos++;
    int temp = arr[pos];
    arr[pos] = item;
    item = temp;
    while (pos != cs) {
      pos = cs;
      for (int i = cs + 1; i < n; i++)
        if (arr[i] < item) pos++;
      while (item == arr[pos]) pos++;
      temp = arr[pos];
      arr[pos] = item;
      item = temp;
    }
  }
}
        </pre>
      </div>
      <div>
        <div class="lang">C++</div>
        <pre>
void cycleSort(int arr[], int n) {
  for (int cs = 0; cs < n - 1; cs++) {
    int item = arr[cs], pos = cs;
    for (int i = cs + 1; i < n; i++)
      if (arr[i] < item) pos++;
    if (pos == cs) continue;
    while (item == arr[pos]) pos++;
    std::swap(item, arr[pos]);
    while (pos != cs) {
      pos = cs;
      for (int i = cs + 1; i < n; i++)
        if (arr[i] < item) pos++;
      while (item == arr[pos]) pos++;
      std::swap(item, arr[pos]);
    }
  }
}
        </pre>
      </div>
    </div>
    <div class="codes-row">
      <div>
        <div class="lang">Python</div>
        <pre>
def cycle_sort(arr):
  n = len(arr)
  for cs in range(n - 1):
    item, pos = arr[cs], cs
    for i in range(cs + 1, n):
      if arr[i] < item:
        pos += 1
    if pos == cs:
      continue
    while item == arr[pos]:
      pos += 1
    arr[pos], item = item, arr[pos]
    while pos != cs:
      pos = cs
      for i in range(cs + 1, n):
        if arr[i] < item:
          pos += 1
      while item == arr[pos]:
        pos += 1
      arr[pos], item = item, arr[pos]
        </pre>
      </div>
      <div>
        <div class="lang">JavaScript</div>
        <pre>
function cycleSort(arr) {
  let n = arr.length;
  for (let cs = 0; cs < n - 1; cs++) {
    let item = arr[cs], pos = cs;
    for (let i = cs + 1; i < n; i++)
      if (arr[i] < item) pos++;
    if (pos === cs) continue;
    while (item === arr[pos]) pos++;
    [arr[pos], item] = [item, arr[pos]];
    while (pos !== cs) {
      pos = cs;
      for (let i = cs + 1; i < n; i++)
        if (arr[i] < item) pos++;
      while (item === arr[pos]) pos++;
      [arr[pos], item] = [item, arr[pos]];
    }
  }
}
        </pre>
      </div>
    </div>
  </div>
</div>


<div id="info-section" style="background:#1f2937;color:#e3f7fa;border-radius:12px;max-width:900px;margin:28px auto 18px auto;padding:24px 22px;box-shadow:0 4px 18px #1e293b30;">
  <h2 style="margin-top:0;color:#93e7fc;">Cycle Sort: Complexity & Key Points</h2>
  <ul style="margin:0 0 12px 24px; font-size:16px;">
    <li><strong>Time complexity:</strong> <code>O(n²)</code></li>
    <li><strong>Space complexity:</strong> <code>O(1)</code> (in-place, minimal writes)</li>
    <li>Minimizes write operations by moving each item directly to its correct position</li>
    <li>Not stable; equal elements may not retain their order</li>
    <li>Best used where write operations are very costly or limited</li>
    <li>Teaches the concept of permutation cycles</li>
  </ul>
</div>

<script>
const ARRAY_MIN = 2, ARRAY_MAX = 20; // allowed input sizes
const NUM_MIN = 0, NUM_MAX = 999;   // allowed values range
const codeLines = [
  'function cycleSort(arr) {',
  '  let n = arr.length;',
  '  for(let cs = 0; cs < n-1; cs++) {',
  '    let item = arr[cs], pos = cs;',
  '    for(let i=cs+1;i<n;i++)',
  '      if(arr[i]<item) pos++;',
  '    if(pos === cs) continue;',
  '    while(item === arr[pos]) pos++;',
  '    [arr[pos], item] = [item, arr[pos]];',
  '    while(pos !== cs) {',
  '      pos = cs;',
  '      for(let i=cs+1;i<n;i++)',
  '        if(arr[i]<item) pos++;',
  '      while(item === arr[pos]) pos++;',
  '      [arr[pos], item] = [item, arr[pos]];',
  '    }',
  '  }',
  '}'
];

let array = [], states = [], stateIdx = 0, animating = false, paused = false, timeoutID = null;

const arrayContainer = document.getElementById('array');
const pointerLabels = document.getElementById('pointerLabels');
const speedSlider = document.getElementById('speedSlider');
const codearea = document.getElementById('codearea');
const explanationBox = document.getElementById('explanation');


function randomArray(size = 9) {
  // Generate random ints between NUM_MIN and NUM_MAX for visualization clarity
  return Array.from({ length: size }, () =>
    Math.floor(Math.random() * (NUM_MAX - NUM_MIN + 1)) + NUM_MIN
  );
}

function renderArray({ current = -1, scanning = -1, pos = -1, placed = [] } = {}) {
  arrayContainer.innerHTML = '';
  pointerLabels.innerHTML = '';

  array.forEach((val, idx) => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    if (idx === current) bar.classList.add('current');
    else if (idx === scanning) bar.classList.add('scanning');
    else if (idx === pos) bar.classList.add('pos');
    else if (placed.includes(idx)) bar.classList.add('placed');
    bar.style.height = (55 + (val / NUM_MAX) * 120) + 'px';
    bar.innerHTML = `<div class="value">${val}</div>`;
    arrayContainer.appendChild(bar);
  });

  // Pointer labels over bars
  if (current !== -1) {
    createPointerLabel(current, 'current', 'Current');
  }
  if (scanning !== -1) {
    createPointerLabel(scanning, 'scanning', 'Scanning');
  }
  if (pos !== -1) {
    createPointerLabel(pos, 'pos', 'Position');
  }
}

function createPointerLabel(idx, className, text) {
  const bar = arrayContainer.children[idx];
  if (!bar) return;

  const pointerSpan = document.createElement('span');
  pointerSpan.classList.add(className);
  pointerSpan.textContent = text;
  pointerSpan.style.position = 'absolute';
  pointerSpan.style.top = '-28px';
  pointerSpan.style.left = '50%';
  pointerSpan.style.transform = 'translateX(-50%)';
  pointerSpan.style.padding = '2px 7px';
  pointerSpan.style.backgroundColor = pointerSpan.classList.contains('current') ? '#fbbf24' :
    pointerSpan.classList.contains('scanning') ? '#f43f5e' :
    pointerSpan.classList.contains('pos') ? '#059669' : '#ccc';
  pointerSpan.style.color = pointerSpan.classList.contains('pos') ? '#d1fae5' : '#000';
  pointerSpan.style.borderRadius = '5px';
  pointerSpan.style.fontSize = '13px';
  pointerSpan.style.fontWeight = '800';
  pointerSpan.style.boxShadow = '0 1px 8px rgba(0,0,0,0.5)';
  pointerSpan.style.userSelect = 'none';
  pointerSpan.style.pointerEvents = 'none';

  const pointersDiv = pointerLabels;
  pointersDiv.style.position = 'relative';
  pointersDiv.style.height = '0px';

  // Position pointerSpan over corresponding bar
  const barRect = bar.getBoundingClientRect();
  const arrayRect = arrayContainer.getBoundingClientRect();
  const leftOffset = bar.offsetLeft + bar.clientWidth / 2;
  pointerSpan.style.position = 'absolute';
  pointerSpan.style.left = leftOffset + 'px';

  pointersDiv.appendChild(pointerSpan);
}

// Explanation snapshot with detailed pointers info
function snapshot(arr, current, scanning, pos, placed, desc) {
  states.push({
    arr: arr.slice(),
    current,
    scanning,
    pos,
    placed: placed.slice(),
    desc
  });
}

// Generate steps for cycle sort visualizing pointers explicitly
async function captureCycleSortSteps() {
  states = [];
  let arr = array.slice();
  let n = arr.length;
  let placed = [];

  for (let cs = 0; cs < n - 1; cs++) {
    let item = arr[cs];
    let pos = cs;

    snapshot(arr, cs, -1, pos, placed, `Cycle start at index ${cs}; item = ${item}`);

    // Find the right position for the current item by scanning
    for (let i = cs + 1; i < n; i++) {
      snapshot(arr, cs, i, pos, placed, `Compare item ${item} with arr[${i}] = ${arr[i]}`);
      if (arr[i] < item) {
        pos++;
        snapshot(arr, cs, i, pos, placed, `Increment position to ${pos} after comparing with arr[${i}]`);
      }
      await new Promise(r => setTimeout(r, 0));
    }

    if (pos === cs) {
      placed.push(cs);
      snapshot(arr, cs, -1, pos, placed, `Item already in correct position at ${pos}; move to next cycle`);
      continue;
    }

    // Skip duplicates
    while (item === arr[pos]) {
      pos++;
      snapshot(arr, cs, -1, pos, placed, `Skipping duplicate at position ${pos}`);
      await new Promise(r => setTimeout(r, 0));
    }

    // Swap item to correct position
    [arr[pos], item] = [item, arr[pos]];
    snapshot(arr, cs, -1, pos, placed, `Placed item ${arr[pos]} at position ${pos}; new item to place is ${item}`);

    // Rotate rest of the cycle
    while (pos !== cs) {
      pos = cs;
      for (let i = cs + 1; i < n; i++) {
        snapshot(arr, cs, i, pos, placed, `Find correct position for item ${item} by comparing with arr[${i}] = ${arr[i]}`);
        if (arr[i] < item) {
          pos++;
          snapshot(arr, cs, i, pos, placed, `Increment position to ${pos} after comparing with arr[${i}]`);
        }
        await new Promise(r => setTimeout(r, 0));
      }
      while (item === arr[pos]) {
        pos++;
        snapshot(arr, cs, -1, pos, placed, `Skipping duplicate at position ${pos}`);
        await new Promise(r => setTimeout(r, 0));
      }
      [arr[pos], item] = [item, arr[pos]];
      snapshot(arr, cs, -1, pos, placed, `Rotate: place ${arr[pos]} at position ${pos}; item to place is now ${item}`);
      await new Promise(r => setTimeout(r, 0));
    }
    placed.push(cs);
    snapshot(arr, cs, -1, -1, placed, `Cycle complete; position ${cs} now sorted`);
  }

  // Mark all as placed finally
  placed = Array.from({ length: n }, (_, i) => i);
  snapshot(arr, -1, -1, -1, placed, "Array fully sorted!");
}

function resetArray() {
  if (animating) return;
  array = randomArray(Math.max(ARRAY_MIN, Math.min(ARRAY_MAX, 9)));
  renderArray();
  pointerLabels.innerHTML = '';
  displayCode(-1);
  states = [];
  stateIdx = 0;
  explanationBox.textContent = '';
}

function useCustomArray() {
  const val = document.getElementById('arrayInput').value.trim();
  const customArr = val.split(',').map(s => +s.trim()).filter(x => !isNaN(x) && x >= NUM_MIN && x <= NUM_MAX);
  if (customArr.length < ARRAY_MIN || customArr.length > ARRAY_MAX) {
    alert(`Please enter between ${ARRAY_MIN} and ${ARRAY_MAX} integers between ${NUM_MIN} and ${NUM_MAX}, comma separated.`);
    return;
  }
  array = customArr;
  renderArray();
  pointerLabels.innerHTML = '';
  displayCode(-1);
  states = [];
  stateIdx = 0;
  explanationBox.textContent = '';
}

async function start() {
  if (animating) return;
  animating = true;
  paused = false;
  states = [];
  stateIdx = 0;
  await captureCycleSortSteps();
  stateIdx = 0;
  nextStep();
}

function pause() {
  paused = true;
  animating = false;
  if (timeoutID) clearTimeout(timeoutID);
}

function nextStep() {
  if (stateIdx >= states.length) {
    animating = false;
    displayCode(-1);
    explanationBox.textContent = '';
    pointerLabels.innerHTML = '';
    return;
  }
  const s = states[stateIdx];
  array = s.arr.slice();
  renderArray({
    current: s.current,
    scanning: s.scanning,
    pos: s.pos,
    placed: s.placed
  });
  explanationBox.textContent = s.desc || "";

  displayCode(-1);
  stateIdx++;
  if (animating && !paused) {
    timeoutID = setTimeout(nextStep, 640 - Number(speedSlider.value));
  }
}

function prevStep() {
  if (stateIdx > 1) stateIdx -= 2;
  if (states.length) nextStep();
}

function stepToStart() {
  stateIdx = 0;
  nextStep();
}

function stepToEnd() {
  stateIdx = states.length - 1;
  nextStep();
}

function displayCode(hl) {
  codearea.innerHTML = '';
  codeLines.forEach((l, i) => {
    const el = document.createElement('span');
    el.className = 'codeline' + (i === hl ? ' highlight' : '');
    el.textContent = l;
    codearea.appendChild(el);
    codearea.appendChild(document.createTextNode('\n'));
  });
}

// Initial setup
resetArray();
displayCode(-1);

</script>
</body>
</html>
