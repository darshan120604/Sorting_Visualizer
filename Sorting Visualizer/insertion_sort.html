<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Insertion Sort Visualizer</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body {
      background: #111827;
      color: #f3f4f6;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
    }
    #main {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 38px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    #visualizer, #codebox {
      background: #21273a;
      border-radius: 12px;
      padding: 26px 18px 18px 18px;
      box-shadow: 0 4px 24px #0003;
    }
    #visualizer { width: 610px; min-width: 350px; }
    #array {
      display: flex;
      align-items: flex-end;
      height: 280px;
      margin: 34px 0 8px 0;
      background: #181e2b;
      border-radius: 10px;
      transition: background 0.3s;
    }
    #explanation {
      margin-top:18px;
      font-size:17px;
      color:#a7ffeb;
      min-height:28px;
      font-family:'Fira Mono',monospace;
      text-shadow: 0 1px 12px #08374942;
      letter-spacing: .5px;
      transition: color 0.2s;
    }
    .bar { flex: 1; margin: 0 3px; background: linear-gradient(180deg,#22d3ee 0%, #1d4ed8 100%); border-radius: 5px 5px 0 0; position: relative; min-width: 16px; transition: background 0.3s, height 0.35s cubic-bezier(.34,1.56,.64,1), box-shadow 0.30s; box-shadow: 0 2px 8px #0ef2; }
    .bar.comparing {
      background: linear-gradient(180deg,#fbbc04 10%,#fb7185 90%);
      box-shadow: 0 2px 14px #fdae1b35;
    }
    .bar.swapping {
      background: linear-gradient(180deg,#a855f7 10%,#2dd4bf 100%);
      box-shadow: 0 2px 14px #a88be742;
    }
    .bar.sorted {
      background: linear-gradient(180deg,#9EDD7D 10%,#2fa94e 90%);
      box-shadow: 0 2px 16px #77df6a66;
    }
    .bar .value {
      position: absolute;
      bottom: 7px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 13px;
      color: #fff;
      text-shadow: 0 1px 6px #000, 0 0 4px #2e2a5c;
      font-weight: bold;
      z-index: 2;
      pointer-events: none;
      letter-spacing: .5px;
      background: rgba(32,36,64,0.22);
      padding: 2px 6px;
      border-radius: 6px;
    }
    .pointers {
      position: absolute;
      top: -23px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      font-weight: 800;
      white-space: nowrap;
      z-index: 10;
      letter-spacing: 0.5px;
      display: flex;
      gap: 2px;
    }
    .pointers span {
      margin: 0 1px;
      padding: 1px 5px;
      border-radius: 5px;
      font-size: 13px;
      border: 1.1px solid;
      box-shadow: 0 1px 6px #03e9f4af;
      user-select: none;
    }
    .pointers span.curr {
      background: #e11d48; color: #fff;
      border-color: #fde68a;
      box-shadow: 0 1px 6px #fb718595;
    }
    .pointers span.comp {
      background: #1e40af; color: #e0e7ef;
      border-color: #a5b4fc;
      box-shadow: 0 1px 6px #2563eb91;
    }
    .pointers span.pos {
      background: #059669; color: #fff;
      border-color: #7dd3fc;
      box-shadow: 0 1px 6px #22d3ee99;
    }
    #controls {
      margin-top: 8px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }
    #controls label,
    #controls input[type=range] {
      margin-bottom: 0;
      font-size: 15.5px;
    }
    #controls button, #controls input[type=range] {
      padding: 6.5px 13px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background: #374151;
      color: #fff;
      cursor: pointer;
      transition: background 0.17s, color 0.17s, box-shadow 0.18s;
      box-shadow: 0 2px 4px #0002;
    }
    #controls button:hover {
      background: #0ea5e9;
      color: #fff;
      box-shadow: 0 4px 15px #49e9fa57;
    }
    #controls input[type=range] {
      accent-color: #3b82f6;
      background: #27273c;
      border-radius: 5px;
      margin-left: 8px;
      width: 90px;
      height: 4px;
    }
    #inputbox {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
    }
    #inputbox input {
      width: 156px;
      padding: 7px 8px;
      border-radius: 5px;
      border: 1.2px solid #1251b0;
      font-size: 15px;
      margin-right: 5px;
      background: #20243d;
      color: #c1d1fb;
      outline: none;
      transition: border 0.16s;
    }
    #inputbox input:focus {
      border-color: #22d3ee;
      background: #181d37;
    }
    #inputbox button {
      padding: 7px 13px;
      font-size: 15px;
      border-radius: 5px;
      background: #1847a3;
      color: #eee;
      border: none;
      cursor: pointer;
      transition: background 0.17s;
    }
    #inputbox button:hover {
      background: #2563eb;
    }
    #codebox { min-width:320px; max-width: 500px; }
    #codebox strong {
      font-size: 17.5px;
      color: #93e7fc;
      letter-spacing: 0.5px;
    }
    pre, #codearea {
      margin: 0;
      padding-top: 5px;
      font-family: 'Fira Mono', 'Consolas', 'monospace';
      font-size:16px;
      line-height: 1.65;
      color: #e0e7ef;
      background: none;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-x: auto;
      max-width: 100%;
    }
    .codeline {
      display:block;
      padding: 0 8px;
      border-radius:6px;
      transition: background 0.19s;
      white-space: pre-wrap !important;
    }
    .highlight {
      background: #0885a0;
      color: #ffeebd;
    }
    a {
      color: #6cf0fe;
      text-decoration: none;
      font-size: 16px;
      padding-left: 14px;
    }
    #purecodebox {
      background:#232c4d;
      margin: 42px auto 44px auto;
      border-radius:13px;
      max-width:1000px;
      padding:26px 23px 17px 23px;
      box-shadow: 0 8px 32px #0ecdee20;
      border: 1.8px solid #0f466b28;
    }
    #purecodebox strong {
      font-size:20px;
      font-weight: 700;
      color: #69f3fc;
      display: block;
      margin-bottom: 12px;
      letter-spacing: .3px;
    }
    .codes-list {
      display: flex; flex-wrap: wrap; gap: 30px;
      justify-content: flex-start;
    }
    .codes-list pre {
      font-size: 13.7px;
      background:#191e2b;
      border-radius: 7px;
      padding:14px 12px 12px 12px;
      margin:7px 0 0 0;
      min-width: 190px;
      max-width: 100%;
      border: 1.2px solid #2d3b54;
      color: #b0e0fa;
      overflow-x: auto;
    }
    .codes-list .lang {
      font-size: 15.5px;
      margin-bottom: 4px;
      color: #69f3fc;
      letter-spacing: 0.2px;
    }
    .codes-row {
      display: flex;
      gap: 36px;
      margin-bottom: 16px;
    }
    .codes-row > div {
      flex: 1 1 0;
      min-width: 180px;
      max-width: 100%;
    }
    @media only screen and (max-width: 1000px) {
      #main { flex-direction: column; gap: 16px;}
      #visualizer { width: 95vw; min-width: 0; }
      #codebox { max-width: 100vw; }
    }
    @media (max-width: 720px) {
      .codes-row { flex-direction: column; gap: 12px; }
    }
  </style>
</head>
<body>
  <a href="index.html">← Back to main index</a>
  <div id="main">
    <div id="visualizer">
      <div id="controls">
        <label>Array size: <input id="sizeSlider" type="range" min="7" max="30" value="14"></label>
        <button onclick="resetArray()">Reset</button>
        <button onclick="start()">▶ Play</button>
        <button onclick="pause()">⏸ Pause</button>
        <button onclick="prevStep()">⏮ Back</button>
        <button onclick="nextStep()">⏭ Next</button>
        <label>Speed: <input id="speedSlider" type="range" min="30" max="600" value="200"></label>
      </div>
      <div id="inputbox">
        <label for="arrayInput">Custom array: </label>
        <input type="text" id="arrayInput" placeholder="e.g. 5,2,9,1,7">
        <button onclick="useCustomArray()">Use Custom Array</button>
      </div>
      <div id="array"></div>
      <div id="explanation" style="margin-top:18px; font-size:17px; color:#a7ffeb; min-height:28px; font-family:'Fira Mono',monospace;"></div>
    </div>
    <div id="codebox">
      <strong>Insertion Sort <span style="font-size:13px; color:#999; font-weight:normal">(JS visualized with highlighting)</span></strong>
      <pre id="codearea"></pre>
    </div>
  </div>

  <div id="purecodebox">
    <strong>Pure Insertion Sort in Java / C++ / Python / JavaScript</strong>
    <div class="codes-list">
      <div class="codes-row">
        <div>
          <div class="lang">Java</div>
<pre>public static void insertionSort(int[] arr) {
    int n = arr.length;
    for (int i = 1; i < n; i++) {
        int key = arr[i];
        int j = i - 1;
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j = j - 1;
        }
        arr[j + 1] = key;
    }
}</pre>
        </div>
        <div>
          <div class="lang">C++</div>
<pre>void insertionSort(vector&lt;int&gt;& arr) {
    int n = arr.size();
    for (int i = 1; i < n; i++) {
        int key = arr[i];
        int j = i - 1;
        while (j >= 0 && arr[j] > key) {
            arr[j + 1] = arr[j];
            j = j - 1;
        }
        arr[j + 1] = key;
    }
}</pre>
        </div>
      </div>
      <div class="codes-row">
        <div>
          <div class="lang">Python</div>
<pre>def insertion_sort(arr):
    n = len(arr)
    for i in range(1, n):
        key = arr[i]
        j = i - 1
        while j >= 0 and arr[j] > key:
            arr[j + 1] = arr[j]
            j -= 1
        arr[j + 1] = key
</pre>
        </div>
        <div>
          <div class="lang">JavaScript</div>
<pre>function insertionSort(arr) {
  let n = arr.length;
  for (let i = 1; i < n; i++) {
    let key = arr[i];
    let j = i - 1;
    while (j >= 0 && arr[j] > key) {
      arr[j + 1] = arr[j];
      j--;
    }
    arr[j + 1] = key;
  }
}
</pre>
        </div>
      </div>
    </div>
  </div>

  <div id="info-section" style="background:#1f2937; color:#e3f7fa; border-radius:12px; max-width:900px; margin:28px auto 18px auto; padding:24px 22px; box-shadow:0 4px 18px #1e293b30;">
    <h2 style="margin-top:0; color:#93e7fc;">Insertion Sort: Complexity & Key Points</h2>
    <ul style="margin:0 0 12px 24px; font-size:16px;">
      <li><strong>Worst-case time complexity:</strong> <code>O(n²)</code> (reverse order)</li>
      <li><strong>Best-case time complexity:</strong> <code>O(n)</code> (already sorted!)</li>
      <li><strong>Average-case time complexity:</strong> <code>O(n²)</code></li>
      <li><strong>Space complexity:</strong> <code>O(1)</code> (in-place)</li>
    </ul>
    <ul style="margin:0 0 0 24px; font-size:16px;">
      <li>Efficient for nearly-sorted or small arrays—often used in hybrid sorts (like TimSort, Introsort).</li>
      <li>At each step, <strong>inserts the current value ('curr')</strong> into already sorted part at left.</li>
      <li><strong>Stable</strong>: maintains relative order of equal elements.</li>
      <li>Shifts larger items right, then places the <strong>key</strong> at its correct position.</li>
      <li>Great for hand-sorting, and educational for building intuition about sorting.</li>
    </ul>
  </div>

<script>
const codeLines = [
  "async function insertionSort(array, render, sleep) {",
  "  let n = array.length;",
  "  for (let i = 1; i < n; i++) {",
  "    let key = array[i];",
  "    let j = i - 1;",
  "    render([i], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j});",
  "    await sleep();",
  "    while (j >= 0 && array[j] > key) {",
  "      array[j + 1] = array[j];",
  "      render([j], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, true);",
  "      await sleep();",
  "      j = j - 1;",
  "      render([j+1], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, false);",
  "      await sleep();",
  "    }",
  "    array[j + 1] = key;",
  "    render([j+1], Array.from({length: i+1}, (_, k) => k), {curr: i, pos: j+1, comp: null}, true);",
  "    await sleep();",
  "  }",
  "  render([], Array.from({length: n}, (_, k) => k), {});",
  "}"
];

// === NEW: Explanation logic ===
function snapshot(arr, comparing, sorted, pointerIndices = {}, swapping, line, desc = '') {
  states.push({
    arr: arr.slice(),
    comparing: comparing.slice ? comparing.slice() : [],
    sorted: sorted.slice ? sorted.slice() : [],
    pointerIndices: { ...pointerIndices },
    swapping: !!swapping,
    code: line,
    desc // step explanation
  });
}

function displayCode(hl) {
  codearea.innerHTML = '';
  codeLines.forEach((l,i) => {
    const el = document.createElement('span');
    el.className = 'codeline' + (i===hl ? ' highlight':'');
    el.textContent = l;
    codearea.appendChild(el);
    codearea.appendChild(document.createTextNode('\n'));
  });
}

let array = [], states = [], stateIdx = 0, animating = false, paused = false, timeoutID = null;
const arrayContainer = document.getElementById('array');
const sizeSlider = document.getElementById('sizeSlider');
const speedSlider = document.getElementById('speedSlider');
const codearea = document.getElementById('codearea');

function randomArray(size) {
  return Array.from({length: size}, () => Math.floor(Math.random()*180)+40);
}

function renderArray(comparing=[], sorted=[], pointerIndices={}, swapping=false) {
  arrayContainer.innerHTML = '';
  array.forEach((val, idx) => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.height = val + 'px';
    let pointerLabels = [];
    if(pointerIndices.curr === idx) pointerLabels.push('<span class="curr">curr</span>');
    if(pointerIndices.comp === idx) pointerLabels.push('<span class="comp">comp</span>');
    if(pointerIndices.pos === idx) pointerLabels.push('<span class="pos">pos</span>');

    if (pointerLabels.length > 0) {
      const pointersDiv = document.createElement('div');
      pointersDiv.className = 'pointers';
      pointersDiv.innerHTML = pointerLabels.join(' ');
      bar.appendChild(pointersDiv);
    }
    bar.innerHTML += `<div class="value">${val}</div>`;

    if (comparing && comparing.includes(idx)) bar.classList.add('comparing');
    if (swapping && comparing && comparing.includes(idx)) bar.classList.add('swapping');
    if (sorted && sorted.includes(idx)) bar.classList.add('sorted');
    arrayContainer.appendChild(bar);
  });
}

async function captureInsertionSortSteps() {
  const arr = array.slice(), n = arr.length; states.length = 0;
  for (let i = 1; i < n; i++) {
    let key = arr[i];
    let j = i - 1;
    snapshot(arr, [i], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, false, 5, `Take ${key} as key to insert`);
    snapshot(arr, [i], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, false, 6, `Start comparing ${key} leftwards`);
    while(j >= 0 && arr[j] > key) {
      snapshot(arr, [j], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, true, 8, `${arr[j]} > ${key}, shift ${arr[j]} right`);
      arr[j+1] = arr[j];
      snapshot(arr, [j], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, true, 9, `Shifted ${arr[j]} to position ${j+1}`);
      j = j - 1;
      snapshot(arr, [j+1], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, false, 11, `Decrement j, now j = ${j}`);
      snapshot(arr, [j+1], Array.from({length: i}, (_, k) => k), {curr: i, pos: null, comp: j}, false, 12, `Check if next left needs to be shifted`);
    }
    arr[j+1] = key;
    let msg = j === i-1
      ? `${key} already in correct spot`
      : `Insert ${key} at position ${j+1}`;
    snapshot(arr, [j+1], Array.from({length: i+1}, (_, k) => k), {curr: i, pos: j+1, comp: null}, true, 15, msg);
    snapshot(arr, [j+1], Array.from({length: i+1}, (_, k) => k), {curr: i, pos: j+1, comp: null}, false, 16, '');
  }
  snapshot(arr, [], Array.from({length: n}, (_, k) => k), {}, false, 18, 'All sorted!');
}

function resetArray() {
  if (animating) return;
  array = randomArray(Number(sizeSlider.value));
  renderArray();
  displayCode(-1);
  states = []; stateIdx = 0;
  document.getElementById('explanation').textContent = '';
}

function useCustomArray() {
  const val = document.getElementById('arrayInput').value;
  const customArr = val.split(',').map(s => +s.trim()).filter(x => !isNaN(x));
  if (customArr.length < 2) {
    alert('Please enter at least 2 numbers, comma separated.');
    return;
  }
  array = customArr;
  renderArray();
  displayCode(-1);
  states = []; stateIdx = 0;
  document.getElementById('explanation').textContent = '';
}

async function start() {
  if (animating) return;
  animating = true; paused = false; states = []; stateIdx = 0;
  await captureInsertionSortSteps();
  stateIdx = 0;
  nextStep();
}

function pause() {
  paused = true; animating = false;
  if(timeoutID) clearTimeout(timeoutID);
}

function nextStep() {
  if (stateIdx >= states.length) {
    animating = false;
    displayCode(-1);
    document.getElementById('explanation').textContent = '';
    return;
  }
  const s = states[stateIdx];
  array = s.arr.slice();
  renderArray(s.comparing, s.sorted, s.pointerIndices || {}, s.swapping);
  displayCode(s.code);
  document.getElementById('explanation').textContent = s.desc || '';
  stateIdx++;
  if (animating && !paused) {
    timeoutID = setTimeout(nextStep, 640 - Number(speedSlider.value));
  }
}

function prevStep() {
  if (stateIdx > 1) stateIdx-=2;
  if (states.length) nextStep();
}

sizeSlider.addEventListener('input', resetArray);
resetArray();
displayCode(-1);
</script>
</body>
</html>
