<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Heap Sort Tree Visualizer</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { background: #111827; color: #f3f4f6; font-family: 'Segoe UI', Arial, sans-serif; margin: 0;}
    #main { display: flex; flex-direction: row; justify-content: center; align-items: flex-start; gap: 38px; margin: 30px 0; flex-wrap: wrap;}
    #visualizer, #codebox { background: #21273a; border-radius: 12px; padding: 24px 16px 14px 16px; box-shadow: 0 4px 24px #0003;}
    #visualizer { width: 670px; min-width: 350px; }
    #array { display: flex; align-items: flex-end; height: 120px; margin: 15px 0 3px 0; background: #181e2b; border-radius: 10px; transition: background 0.3s;}
    .bar { flex: 1; margin: 0 3px; background: linear-gradient(180deg,#22d3ee 0%, #1d4ed8 100%); border-radius: 5px 5px 0 0; position: relative; min-width: 16px;
      transition: background 0.3s, height 0.35s cubic-bezier(.34,1.56,.64,1), box-shadow 0.30s;
      box-shadow: 0 2px 8px #0ef2; display: flex; align-items: flex-end; justify-content: center;}
    .bar .value { position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); font-size: 12px; color: #fff; font-weight: bold;
      z-index: 2; pointer-events: none; background: rgba(32,36,64,0.18); padding: 2px 6px; border-radius: 6px; }
    .bar.comparing { background: linear-gradient(180deg,#fbbf24 10%,#fb923c 90%);}
    .bar.swapping { background: linear-gradient(180deg,#9f35fa 10%,#f370b2 100%);}
    .bar.sorted { background: linear-gradient(180deg,#9EDD7D 10%,#2fa94e 90%);}
    #heap-tree { width: 100%; min-height: 190px; padding: 3px; position: relative; background: transparent; margin-bottom: 18px; }
    .tree-link {
      stroke: #67e8f9; stroke-width: 2.3; opacity: 0.4;
    }
    .heap-node {
      fill: url(#heapNodeGrad);
      stroke: #278fbf; stroke-width: 2;
      cursor: pointer;
      filter: drop-shadow(0 2px 7px #51e7fa51);
    }
    .heap-node.comparing { fill: url(#heapNodeCmpGrad); stroke: #f59e42;}
    .heap-node.swapping { fill: url(#heapNodeSwapGrad); stroke: #cc56cf;}
    .heap-node.sorted { fill: url(#heapNodeSortedGrad); stroke: #54e55f;}
    .heap-label {
      font-size: 14px; font-family: 'Fira Mono', monospace; fill: #fff; font-weight: 700; user-select: none;
      paint-order: stroke; stroke: #1b2850; stroke-width: 2.1px;
    }
    #explanation { margin-top: 12px; font-size: 17px; color: #a7ffeb; min-height: 24px; font-family: 'Fira Mono', monospace; text-shadow: 0 1px 8px #096c5e32; letter-spacing: .5px;}
    #controls { margin: 7px 0 8px 0; display: flex; flex-wrap: wrap; align-items: center; gap: 10px;}
    #controls label, #controls input[type=range] { margin-bottom: 0; font-size: 15px;}
    #controls button, #controls input[type=range] { padding: 6px 13px; font-size: 16px; border-radius: 6px; border: none;
      background: #374151; color: #fff; cursor: pointer; transition: background 0.17s, color 0.17s, box-shadow 0.18s; box-shadow: 0 2px 4px #0002;}
    #controls button:hover { background: #0ea5e9; color: #fff;}
    #controls input[type=range] { accent-color: #3b82f6; background: #27273c; border-radius: 5px; margin-left: 8px; width: 90px; height: 4px;}
    #inputbox { margin-top: 12px; display: flex; align-items: center; gap: 10px; font-size: 15px; }
    #inputbox input { width: 176px; padding: 7px 8px; border-radius: 6px; border: 1.2px solid #1251b0; font-size: 15px; margin-right: 5px; background: #20243d; color: #c1d1fb; outline: none; transition: border 0.16s;}
    #inputbox input:focus { border-color: #22d3ee; background: #181d37;}
    #inputbox button { padding: 7px 13px; border-radius: 5px; background: #1847a3; color: #eee; border: none; cursor: pointer;}
    #inputbox button:hover { background: #2563eb; }
    #codebox { min-width:300px; max-width: 520px;}
    #codebox strong { font-size: 17.5px; color: #93e7fc; letter-spacing: 0.5px;}
    pre { margin: 0; padding-top: 5px; font-family: 'Fira Mono', 'Consolas', 'monospace'; font-size:16px; line-height: 1.65; color: #e0e7ef; background: none; white-space: pre-wrap; word-break: break-word; overflow-x: auto; max-width: 100%;}
    .codeline { display:block; padding: 0 8px; border-radius:6px; transition: background 0.19s; white-space: pre-wrap !important;}
    .highlight { background: #155ab5; color: #ffeebd;}
    #purecodebox { background:#232c4d; margin: 36px auto 32px auto; border-radius:13px; max-width:1000px; padding:26px 23px 17px 23px; box-shadow: 0 8px 32px #0ecdee20; border: 1.8px solid #0f466b28; }
    #purecodebox strong { font-size:20px; font-weight: 700; color: #93e7fc; display: block; margin-bottom: 12px; letter-spacing: .3px;}
    .codes-list { display: flex; flex-wrap: wrap; gap: 28px; justify-content: flex-start;}
    .codes-list pre { font-size: 13.7px; background:#191e2b; border-radius: 7px; padding:14px 12px 12px 12px; margin:7px 0 0 0; min-width: 190px; max-width: 100%; border: 1.2px solid #2d3b54; color: #b0e0fa;}
    .codes-list .lang { font-size: 15.5px; margin-bottom: 4px; color: #93e7fc; letter-spacing: 0.2px; }
    .codes-row { display: flex; gap: 36px; margin-bottom: 11px;}
    .codes-row > div { flex: 1 1 0; min-width: 180px;}

    a {       color: #93e7fc;
        ; text-decoration: none; font-size: 16px; padding-left: 14px;}
    @media only screen and (max-width: 1100px) { #main { flex-direction: column; gap: 16px;} #visualizer { width: 99vw; min-width: 0; } #codebox { max-width: 100vw; } }
    @media (max-width: 720px) { .codes-row { flex-direction: column; gap: 12px; } }
  </style>
</head>
<body>
<a href="index.html">← Back to main index</a>
<div id="main">
  <div id="visualizer">
    <div id="controls">
      <button onclick="resetArray()">Reset</button>
      <button onclick="start()">▶ Play</button>
      <button onclick="pause()">⏸ Pause</button>
      <button onclick="stepToStart()">|⏮ Start</button>
      <button onclick="prevStep()">⏮ Back</button>
      <button onclick="nextStep()">⏭ Next</button>
      <button onclick="stepToEnd()">End ⏭|</button>
      <label>Speed: <input id="speedSlider" type="range" min="30" max="600" value="150"></label>
    </div>
    <div id="inputbox">
      <label for="arrayInput">Custom array (exactly 9, 0–999): </label>
      <input type="text" id="arrayInput" placeholder="e.g. 23,14,88,11,77,50,65,32,2">
      <button onclick="useCustomArray()">Use Custom Array</button>
    </div>
    <div id="array"></div>
    <svg id="heap-tree" width="100%" height="210"></svg>
    <div id="explanation"></div>
  </div>
  <div id="codebox">
    <strong>Heap Sort <span style="font-size:13px; color:#999; font-weight:normal">(JS visualized with highlighting)</span></strong>
    <pre id="codearea"></pre>
  </div>
</div>

<div id="purecodebox">
  <strong>Pure Heap Sort in Java / C++ / Python / JavaScript</strong>
  <div class="codes-list">
    <div class="codes-row">
      <div>
        <div class="lang">Java</div>
<pre>public static void heapSort(int[] arr) {
  int n = arr.length;
  for (int i = n/2-1; i >= 0; i--) heapify(arr, n, i);
  for (int i=n-1;i>0;i--) {
    int t=arr[0]; arr[0]=arr[i]; arr[i]=t;
    heapify(arr, i, 0);
  }
}
static void heapify(int[] arr, int n, int i) {
  int largest = i, l = 2*i+1, r = 2*i+2;
  if (l<n && arr[l]>arr[largest]) largest=l;
  if (r<n && arr[r]>arr[largest]) largest=r;
  if (largest != i) {
    int t=arr[i]; arr[i]=arr[largest]; arr[largest]=t;
    heapify(arr, n, largest);
  }
}</pre>
      </div>
      <div>
        <div class="lang">C++</div>
<pre>void heapify(int arr[], int n, int i) {
  int largest=i, l=2*i+1, r=2*i+2;
  if(l<n&&arr[l]>arr[largest]) largest=l;
  if(r<n&&arr[r]>arr[largest]) largest=r;
  if(largest!=i) {
    swap(arr[i], arr[largest]);
    heapify(arr, n, largest);
  }
}
void heapSort(int arr[], int n) {
  for(int i=n/2-1;i>=0;i--) heapify(arr, n, i);
  for(int i=n-1;i>0;i--) {
    swap(arr[0], arr[i]);
    heapify(arr, i, 0);
  }
}</pre>
      </div>
    </div>
    <div class="codes-row">
      <div>
        <div class="lang">Python</div>
<pre>def heapify(arr, n, i):
    largest = i
    l, r = 2*i+1, 2*i+2
    if l<n and arr[l]>arr[largest]: largest=l
    if r<n and arr[r]>arr[largest]: largest=r
    if largest!=i:
        arr[i], arr[largest]=arr[largest],arr[i]
        heapify(arr, n, largest)
def heap_sort(arr):
    n = len(arr)
    for i in range(n//2-1, -1, -1): heapify(arr, n, i)
    for i in range(n-1, 0, -1):
        arr[0], arr[i] = arr[i], arr[0]
        heapify(arr, i, 0)
</pre>
      </div>
      <div>
        <div class="lang">JavaScript</div>
<pre>function heapify(arr, n, i) {
  let largest=i, l=2*i+1, r=2*i+2;
  if(l<n && arr[l]>arr[largest]) largest=l;
  if(r<n && arr[r]>arr[largest]) largest=r;
  if(largest!==i) {
    [arr[i], arr[largest]] = [arr[largest], arr[i]];
    heapify(arr, n, largest);
  }
}
function heapSort(arr) {
  let n = arr.length;
  for(let i=Math.floor(n/2)-1; i>=0; i--) heapify(arr,n,i);
  for(let i=n-1;i>0;i--) {
    [arr[0], arr[i]] = [arr[i], arr[0]];
    heapify(arr, i, 0);
  }
}
</pre>
      </div>
    </div>
  </div>
</div>
<div id="info-section" style="background:#1f2937; color:#e3f7fa; border-radius:12px; max-width:900px; margin:28px auto 18px auto; padding:24px 22px; box-shadow:0 4px 18px #1e293b30;">
  <h2 style="margin-top:0;color:#93e7fc;">Heap Sort: Complexity & Key Points</h2>
  <ul style="margin:0 0 12px 24px; font-size:16px;">
    <li><strong>Time complexity:</strong> <code>O(n log n)</code></li>
    <li><strong>Space complexity:</strong> <code>O(1)</code> (in-place)</li>
    <li>Not stable; relative order of equal elements may change</li>
    <li>Great for visualizing heapify and extract-max!</li>
    <li>Binary heap tree (left, right child: <code>2i+1</code>, <code>2i+2</code>)</li>
    <li>Every swap/heapify step is shown in both the array and tree</li>
  </ul>
</div>
<svg height="0" width="0">
  <defs>
    <linearGradient id="heapNodeGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="10%" stop-color="#22d3ee"/><stop offset="90%" stop-color="#1d4ed8"/>
    </linearGradient>
    <linearGradient id="heapNodeCmpGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="10%" stop-color="#fbbf24"/><stop offset="90%" stop-color="#fb923c"/>
    </linearGradient>
    <linearGradient id="heapNodeSwapGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="9%" stop-color="#9f35fa"/><stop offset="91%" stop-color="#f370b2"/>
    </linearGradient>
    <linearGradient id="heapNodeSortedGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="10%" stop-color="#9EDD7D"/><stop offset="90%" stop-color="#2fa94e"/>
    </linearGradient>
  </defs>
</svg>
<script>
const N = 9;   // Fixed size for tree clarity
const BAR_MIN = 0, BAR_MAX = 999;
const codeLines = [
  "function heapify(arr, n, i) {",
  "  let largest = i, l = 2*i+1, r = 2*i+2;",
  "  if (l < n && arr[l] > arr[largest]) largest = l;",
  "  if (r < n && arr[r] > arr[largest]) largest = r;",
  "  if (largest !== i) {",
  "    [arr[i], arr[largest]] = [arr[largest], arr[i]];",
  "    heapify(arr, n, largest);",
  "  }",
  "}",
  "function heapSort(arr) {",
  "  let n = arr.length;",
  "  for (let i = Math.floor(n/2)-1; i >= 0; i--) heapify(arr, n, i);",
  "  for (let i = n-1; i>0; i--) {",
  "    [arr[0], arr[i]] = [arr[i], arr[0]];",
  "    heapify(arr, i, 0);",
  "  }",
  "}"
];
let array = [], states = [], stateIdx = 0, animating = false, paused = false, timeoutID = null;
const arrayContainer = document.getElementById('array');
const treeSVG = document.getElementById('heap-tree');
const speedSlider = document.getElementById('speedSlider');
const codearea = document.getElementById('codearea');
const explanationBox = document.getElementById('explanation');

function randomArray(n=N) {
  return Array.from({length: n}, () => Math.floor(Math.random()*(BAR_MAX+1)));
}
function renderArray(comparing=[], sorted=[]) {
  arrayContainer.innerHTML = '';
  array.forEach((val, idx) => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.style.height = (50 + (val/BAR_MAX)*90) + 'px';
    bar.innerHTML = `<div class="value">${val}</div>`;
    if (comparing && comparing.includes(idx)) bar.classList.add('comparing');
    if (sorted && sorted.includes(idx)) bar.classList.add('sorted');
    arrayContainer.appendChild(bar);
  });
}

// Calculate tree SVG node positions for 9 nodes (fixed small N; otherwise, tree can be dynamic)
function getTreeCoords(n=N) {
  // Level order: 1,2,4,8... nodes. Layout by depth.
  const W = 600, startY = 34, rowDY = 55;
  const coords = [];
  const levels = [[0],[1,2],[3,4,5,6],[7,8]];
  const xSlots = [[W/2],[W/4,W*3/4],[W/8,W*3/8,W*5/8,W*7/8],[W/16,W*3/16,W*5/16,W*7/16,W*9/16,W*11/16,W*13/16,W*15/16]];
  for(let lvl=0,y=startY; lvl<levels.length; lvl++,y+=rowDY){
    let group = levels[lvl], xs = xSlots[lvl];
    for(let i=0; i<group.length; i++){
      coords[group[i]] = {x: xs[i], y:y};
    }
  }
  return coords;
}
function renderTree(comparing=[], sorted=[]) {
  // Render tree for array in heap form
  const coords = getTreeCoords(N), radius = 18;
  treeSVG.innerHTML = '';
  // links first
  for(let i=0;i<N;i++){
    let li = 2*i+1, ri=2*i+2;
    if(li<N){
      treeSVG.insertAdjacentHTML("beforeend",
        `<line class="tree-link" x1="${coords[i].x}" y1="${coords[i].y}" x2="${coords[li].x}" y2="${coords[li].y}"></line>`);
    }
    if(ri<N){
      treeSVG.insertAdjacentHTML("beforeend",
        `<line class="tree-link" x1="${coords[i].x}" y1="${coords[i].y}" x2="${coords[ri].x}" y2="${coords[ri].y}"></line>`);
    }
  }
  // nodes next
  for(let i=0; i<N; i++){
    let nodeClass = 'heap-node';
    if(comparing && comparing.includes(i)) nodeClass += ' comparing';
    if(sorted && sorted.includes(i)) nodeClass += ' sorted';
    treeSVG.insertAdjacentHTML("beforeend",
      `<circle class="${nodeClass}" cx="${coords[i].x}" cy="${coords[i].y}" r="${radius}"></circle>`);
    treeSVG.insertAdjacentHTML("beforeend",
      `<text class="heap-label" x="${coords[i].x}" y="${coords[i].y+6}" text-anchor="middle">${array[i]}</text>`);
  }
}

function snapshot(arr, comparing, sorted, desc) {
  // Save all needed visual state
  states.push({
    arr: arr.slice(),
    comparing: comparing ? comparing.slice() : [],
    sorted: sorted ? sorted.slice() : [],
    desc
  });
}
function heapifySteps(arr, n, i, sortedIndices) {
  let steps = [];
  let copy = arr.slice();
  let largest = i, l = 2*i+1, r = 2*i+2;
  if(l < n){
    steps.push({arr: copy.slice(), comparing:[i,l], sorted:sortedIndices, desc:`Compare arr[${i}] = ${copy[i]} and left arr[${l}] = ${copy[l]}`});
    if(copy[l] > copy[largest]) largest = l;
  }
  if(r < n){
    steps.push({arr: copy.slice(), comparing:[largest,r], sorted:sortedIndices, desc:`Compare current largest arr[${largest}] = ${copy[largest]} and right arr[${r}] = ${copy[r]}`});
    if(copy[r] > copy[largest]) largest = r;
  }
  if(largest !== i){
    steps.push({arr: copy.slice(), comparing:[i,largest], sorted:sortedIndices, desc:`Swap arr[${i}] = ${copy[i]} and arr[${largest}] = ${copy[largest]}`});
    [copy[i], copy[largest]] = [copy[largest], copy[i]];
    let childSteps = heapifySteps(copy, n, largest, sortedIndices);
    return [...steps, ...childSteps];
  } else {
    steps.push({arr: copy.slice(), comparing:[i], sorted:sortedIndices, desc:`Node arr[${i}] = ${copy[i]} is correct.`});
    return steps;
  }
}
async function captureHeapSortSteps() {
  states = [];
  let arr = array.slice(), n = arr.length;
  let sortedIndices = [];
  // Build max heap
  for(let i=Math.floor(n/2)-1; i>=0; i--){
    let steps = heapifySteps(arr, n, i, sortedIndices);
    for(let s of steps){
      snapshot(s.arr, s.comparing, s.sorted, s.desc);
      arr = s.arr.slice();
      await new Promise(res=>setTimeout(res,0));
    }
  }
  // Extract from heap
  for(let i=n-1; i>0; i--){
    snapshot(arr, [0,i], sortedIndices, `Swap arr[0] = ${arr[0]} and arr[${i}] = ${arr[i]}`);
    [arr[0],arr[i]] = [arr[i],arr[0]];
    sortedIndices.push(i);
    let steps = heapifySteps(arr, i, 0, sortedIndices);
    for(let s of steps){
      snapshot(s.arr, s.comparing, s.sorted, s.desc);
      arr = s.arr.slice();
      await new Promise(res=>setTimeout(res,0));
    }
  }
  sortedIndices.push(0);
  snapshot(arr, [], sortedIndices, 'Done! Array is sorted.');
}
function renderAll() {
  const s = states[stateIdx];
  array = s.arr.slice();
  renderArray(s.comparing, s.sorted);
  renderTree(s.comparing, s.sorted);
  explanationBox.textContent = s.desc || '';
  displayCode(-1);
}
function resetArray() {
  if (animating) return;
  array = randomArray(N);
  renderArray();
  renderTree();
  displayCode(-1);
  states = []; stateIdx = 0;
  explanationBox.textContent = '';
}
function useCustomArray() {
  const val = document.getElementById('arrayInput').value;
  const customArr = val.split(',').map(s => +s.trim()).filter(x => !isNaN(x) && x >= BAR_MIN && x <= BAR_MAX);
  if (customArr.length !== N) {
    alert(`Please enter exactly ${N} integers between 0 and 999, comma separated.`);
    return;
  }
  array = customArr;
  renderArray();
  renderTree();
  displayCode(-1);
  states = []; stateIdx = 0;
  explanationBox.textContent = '';
}
async function start() {
  if (animating) return;
  animating = true; paused = false; states = []; stateIdx = 0;
  await captureHeapSortSteps();
  stateIdx = 0;
  nextStep();
}
function pause() { paused = true; animating = false; if(timeoutID) clearTimeout(timeoutID);}
function nextStep() {
  if (stateIdx >= states.length) { animating = false; displayCode(-1); explanationBox.textContent = ''; return;}
  renderAll();
  stateIdx++;
  if (animating && !paused) {
    timeoutID = setTimeout(nextStep, 640 - Number(speedSlider.value));
  }
}
function prevStep() { if (stateIdx > 1) stateIdx-=2; if (states.length) nextStep();}
function stepToStart() { stateIdx = 0; nextStep();}
function stepToEnd() { stateIdx = states.length-1; nextStep();}
function displayCode(hl) {
  codearea.innerHTML = '';
  codeLines.forEach((l,i) => {
    const el = document.createElement('span');
    el.className = 'codeline' + (i===hl ? ' highlight':'');
    el.textContent = l;
    codearea.appendChild(el);
    codearea.appendChild(document.createTextNode('\n'));
  });
}
speedSlider.addEventListener('input', ()=>{});
resetArray();
displayCode(-1);
</script>
</body>
</html>
