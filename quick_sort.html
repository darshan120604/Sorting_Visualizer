<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Quick Sort Visualizer</title>
<style>
  body {
    background: #111827;
    color: #f3f4f6;
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 0;
  }
  #main {
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
    gap: 38px;
    margin: 40px 0;
    flex-wrap: wrap;
  }
  #visualizer, #codebox {
    background: #21273a;
    border-radius: 12px;
    padding: 26px 18px 18px 18px;
    box-shadow: 0 4px 24px #0003;
  }
  #visualizer { width: 610px; min-width: 350px; }
  #array {
    display: flex;
    align-items: flex-end;
    height: 280px;
    margin: 34px 0 8px 0;
    background: #181e2b;
    border-radius: 10px;
    transition: background 0.3s;
    position: relative;
  }
  #explanation {
    margin-top: 18px;
    font-size: 18px;
    color: #a7ffeb;
    min-height: 36px;
    font-family: 'Fira Mono', monospace;
    text-shadow: 0 1px 8px #096c5e32;
    letter-spacing: .5px;
    transition: color 0.2s;
  }
  .bar { flex: 1; margin: 0 3px; background: linear-gradient(180deg,#22d3ee 0%, #1d4ed8 100%); border-radius: 5px 5px 0 0; position: relative; min-width: 16px; transition: background 0.3s, height 0.35s cubic-bezier(.34,1.56,.64,1), box-shadow 0.30s; box-shadow: 0 2px 8px #0ef2; }
  .bar.pivot {
    background: linear-gradient(180deg,#d946ef 10%, #9333ea 90%);
    box-shadow: 0 2px 14px #b450f9aa;
  }
  .bar.low {
    background: linear-gradient(180deg,#2563eb 10%, #3b82f6 90%);
    box-shadow: 0 2px 14px #60a5faaa;
  }
  .bar.high {
    background: linear-gradient(180deg,#16a34a 10%, #22c55e 90%);
    box-shadow: 0 2px 14px #4ade8099;
  }
  .bar.current {
    background: linear-gradient(180deg,#facc15 10%, #eab308 90%);
    box-shadow: 0 2px 14px #facc1588;
  }
  .bar.swapping {
    background: linear-gradient(180deg,#f43f5e 10%, #a21caf 90%);
    box-shadow: 0 2px 16px #f43f5eaa;
  }
  .bar.sorted {
    background: linear-gradient(180deg,#22c55e 10%, #15803d 90%);
    box-shadow: 0 2px 16px #34d399cc;
  }
  .bar .value {
    position: absolute;
    bottom: 7px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 13px;
    color: #fff;
    text-shadow: 0 1px 6px #000, 0 0 4px #2e2a5c;
    font-weight: bold;
    z-index: 2;
    pointer-events: none;
    letter-spacing: .5px;
    background: rgba(32,36,64,0.22);
    padding: 2px 6px;
    border-radius: 6px;
  }
  .pointers {
    position: absolute;
    top: -26px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 14px;
    font-weight: 800;
    white-space: nowrap;
    z-index: 10;
    letter-spacing: 0.5px;
    display: flex;
    gap: 5px;
  }
  .pointers span {
    margin: 0 1.5px;
    padding: 1px 6px;
    border-radius: 5px;
    font-size: 13px;
    border: 1.5px solid;
    box-shadow: 0 1px 8px #22d3eecc;
    user-select: none;
  }
  .pointers .pivot { background: #9333ea; color: #eee; border-color: #a855f7; }
  .pointers .low { background: #2563eb; color: #dbeafe; border-color: #3b82f6; }
  .pointers .high { background: #16a34a; color: #d1fae5; border-color: #22c55e; }
  .pointers .curr { background: #facc15; color: #92400e; border-color: #fbbf24; }
  
  #controls {
    margin-top: 8px;
    margin-bottom: 10px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
  }
  #controls label, #controls input[type=range] {
    margin-bottom: 0;
    font-size: 15.5px;
  }
  #controls button, #controls input[type=range] {
    padding: 6.5px 13px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    background: #374151;
    color: #fff;
    cursor: pointer;
    transition: background 0.17s, color 0.17s, box-shadow 0.18s;
    box-shadow: 0 2px 4px #0002;
  }
  #controls button:hover {
    background: #0ea5e9;
    color: #fff;
    box-shadow: 0 4px 15px #49e9fa57;
  }
  #controls input[type=range] {
    accent-color: #3b82f6;
    background: #27273c;
    border-radius: 5px;
    margin-left: 8px;
    width: 90px;
    height: 4px;
  }
  #inputbox {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
  }
  #inputbox input {
    width: 160px;
    padding: 7px 8px;
    border-radius: 5px;
    border: 1.2px solid #1251b0;
    font-size: 15px;
    margin-right: 5px;
    background: #20243d;
    color: #c1d1fb;
    outline: none;
    transition: border 0.16s;
  }
  #inputbox input:focus {
    border-color: #22d3ee;
    background: #181d37;
  }
  #inputbox button {
    padding: 7px 13px;
    font-size: 15px;
    border-radius: 5px;
    background: #1847a3;
    color: #eee;
    border: none;
    cursor: pointer;
    transition: background 0.17s;
  }
  #inputbox button:hover {
    background: #2563eb;
  }
  #codebox {
    min-width: 320px;
    max-width: 500px;
  }
  #codebox strong {
    font-size: 17.5px;
    color: #93e7fc;
    letter-spacing: 0.5px;
  }
  pre, #codearea {
    margin: 0;
    padding-top: 5px;
    font-family: 'Fira Mono', 'Consolas', 'monospace';
    font-size: 16px;
    line-height: 1.65;
    color: #e0e7ef;
    background: none;
    white-space: pre-wrap;
    word-break: break-word;
    overflow-x: auto;
    max-width: 100%;
  }
  .codeline {
    display: block;
    padding: 0 8px;
    border-radius: 6px;
    transition: background 0.19s;
    white-space: pre-wrap !important;
  }
  .highlight {
    background: #db2777;
    color: #fff;
  }
  a {
      color: #6cf0fe;
      text-decoration: none;
      font-size: 16px;
      padding-left: 14px;
    }
    #purecodebox { background:#232c4d; margin: 42px auto 44px auto; border-radius:13px; max-width:1000px; padding:26px 23px 17px 23px; box-shadow: 0 8px 32px #0ecdee20; border: 1.8px solid #0f466b28; }

  #purecodebox strong {
    font-size: 20px;
    font-weight: 700;
    color: #93e7fc;

    display: block;
    margin-bottom: 12px;
    letter-spacing: 0.3px;
  }
  .codes-list {
    display: flex;
    flex-wrap: wrap;
    gap: 30px;
    justify-content: flex-start;
  }
  .codes-list pre {
    font-size: 13.7px;
    background: #1a2139;
    border-radius: 7px;
    padding: 14px 12px 12px 12px;
    margin: 7px 0 0 0;
    min-width: 190px;
    max-width: 100%;
    border: 1.2px solid #4b105f;
    color: #93e7fc;

    overflow-x: auto;
  }
  .codes-list .lang {
    font-size: 15.5px;
    margin-bottom: 4px;
    color: #93e7fc;

    letter-spacing: 0.2px;
  }
  .codes-row {
    display: flex;
    gap: 36px;
    margin-bottom: 16px;
  }
  .codes-row > div {
    flex: 1 1 0;
    min-width: 180px;
    max-width: 100%;
  }
  @media only screen and (max-width: 1000px) {
    #main { flex-direction: column; gap: 16px;}
    #visualizer { width: 95vw; min-width: 0; }
    #codebox { max-width: 100vw; }
  }
  @media (max-width: 720px) {
    .codes-row { flex-direction: column; gap: 12px; }
  }
</style>
</head>
<body>
  <a href="index.html">← Back to main index</a>
  <div id="main">
    <div id="visualizer">
      <div id="controls">
        <label>Array size: <input id="sizeSlider" type="range" min="7" max="40" value="14" /></label>
        <button onclick="resetArray()">Reset</button>
        <button onclick="start()">▶ Play</button>
        <button onclick="pause()">⏸ Pause</button>
        <button onclick="prevStep()">⏮ Back</button>
        <button onclick="nextStep()">⏭ Next</button>
        <label>Speed: <input id="speedSlider" type="range" min="30" max="600" value="200" /></label>
      </div>
      <div id="inputbox">
        <label for="arrayInput">Custom array: </label>
        <input type="text" id="arrayInput" placeholder="e.g. 5,2,9,1,7" />
        <button onclick="useCustomArray()">Use Custom Array</button>
      </div>
      <div id="array"></div>
      <div id="explanation"></div>
    </div>
    <div id="codebox">
      <strong>Quick Sort <span style="font-size:13px; color:#999; font-weight:normal">(JS visualized with highlighting)</span></strong>
      <pre id="codearea"></pre>
    </div>
  </div>
  <div id="purecodebox">
    <strong>Pure Quick Sort in Java / C++ / Python / JavaScript</strong>
    <div class="codes-list">
      <div class="codes-row">
        <div>
          <div class="lang">Java</div>
<pre>public static void quickSort(int[] arr, int low, int high) {
  if (low < high) {
    int pi = partition(arr, low, high);
    quickSort(arr, low, pi - 1);
    quickSort(arr, pi + 1, high);
  }
}
public static int partition(int[] arr, int low, int high) {
  int pivot = arr[high];
  int i = low - 1;
  for (int j = low; j < high; j++) {
    if (arr[j] <= pivot) {
      i++;
      int temp = arr[i];
      arr[i] = arr[j];
      arr[j] = temp;
    }
  }
  int temp = arr[i + 1];
  arr[i + 1] = arr[high];
  arr[high] = temp;
  return i + 1;
}</pre>
        </div>
        <div>
          <div class="lang">C++</div>
<pre>void quickSort(vector&lt;int&gt;& arr, int low, int high) {
  if (low < high) {
    int pi = partition(arr, low, high);
    quickSort(arr, low, pi - 1);
    quickSort(arr, pi + 1, high);
  }
}
int partition(vector&lt;int&gt;& arr, int low, int high) {
  int pivot = arr[high];
  int i = low - 1;
  for (int j = low; j < high; j++) {
    if (arr[j] <= pivot) {
      i++;
      swap(arr[i], arr[j]);
    }
  }
  swap(arr[i + 1], arr[high]);
  return i + 1;
}</pre>
        </div>
      </div>
      <div class="codes-row">
        <div>
          <div class="lang">Python</div>
<pre>def quick_sort(arr, low, high):
  if low < high:
    pi = partition(arr, low, high)
    quick_sort(arr, low, pi-1)
    quick_sort(arr, pi+1, high)
def partition(arr, low, high):
  pivot = arr[high]
  i = low - 1
  for j in range(low, high):
    if arr[j] <= pivot:
      i += 1
      arr[i], arr[j] = arr[j], arr[i]
  arr[i+1], arr[high] = arr[high], arr[i+1]
  return i + 1</pre>
        </div>
        <div>
          <div class="lang">JavaScript</div>
<pre>async function quickSort(arr, low, high, render, sleep) {
  if (low < high) {
    let pi = await partition(arr, low, high, render, sleep);
    await quickSort(arr, low, pi - 1, render, sleep);
    await quickSort(arr, pi + 1, high, render, sleep);
  }
}
async function partition(arr, low, high, render, sleep) {
  let pivot = arr[high];
  let i = low - 1;
  for (let j = low; j < high; j++) {
    render([j], [], {low, high, pivotIndex: high}, false, `Compare ${arr[j]} with pivot ${pivot}`);
    await sleep();
    if (arr[j] <= pivot) {
      i++;
      [arr[i], arr[j]] = [arr[j], arr[i]];
      render([i, j], [], {low, high, pivotIndex: high}, true, `Swap ${arr[i]} and ${arr[j]}`);
      await sleep();
    }
  }
  [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
  render([i + 1, high], [], {low, high, pivotIndex: high}, true, `Swap pivot ${arr[i + 1]} to position ${i + 1}`);
  await sleep();
  return i + 1;
}</pre>
        </div>
      </div>
    </div>
  </div>
  <div id="info-section" style="background:#1f2937; color:#e3f7fa; border-radius:12px; max-width:900px; margin:28px auto 18px auto; padding:24px 22px; box-shadow:0 4px 18px #1e293b30;">
    <h2 style="margin-top:0;       color: #93e7fc;
">Quick Sort: Complexity & Key Points</h2>
    <ul style="margin:0 0 12px 24px; font-size:16px;">
      <li><strong>Worst-case time complexity:</strong> <code>O(n²)</code> (when pivot choices are poor)</li>
      <li><strong>Best-case time complexity:</strong> <code>O(n log n)</code> (balanced partitions)</li>
      <li><strong>Average-case time complexity:</strong> <code>O(n log n)</code></li>
      <li><strong>Space complexity:</strong> <code>O(log n)</code> (recursive stack)</li>
    </ul>
    <ul style="margin:0 0 0 24px; font-size:16px;">
      <li>Divide and conquer algorithm using pivot to partition the array.</li>
      <li>In-place sorting (usually) with efficient average performance.</li>
      <li>Pivot choice affects performance critically.</li>
      <li>Not stable by default; equal elements can change relative order.</li>
      <li>Widely used and very fast in practice.</li>
    </ul>
  </div>
<script>
const codeLines = [
  "async function quickSort(arr, low, high, render, sleep) {",
  "  if (low < high) {",
  "    let pi = await partition(arr, low, high, render, sleep);",
  "    await quickSort(arr, low, pi - 1, render, sleep);",
  "    await quickSort(arr, pi + 1, high, render, sleep);",
  "  }",
  "}",
  "async function partition(arr, low, high, render, sleep) {",
  "  let pivot = arr[high];",
  "  let i = low - 1;",
  "  for (let j = low; j < high; j++) {",
  "    render([j], [], {low, high, pivotIndex: high}, false, `Compare ${arr[j]} with pivot ${pivot}`);",
  "    await sleep();",
  "    if (arr[j] <= pivot) {",
  "      i++;",
  "      [arr[i], arr[j]] = [arr[j], arr[i]];",
  "      render([i, j], [], {low, high, pivotIndex: high}, true, `Swap ${arr[i]} and ${arr[j]}`);",
  "      await sleep();",
  "    }",
  "  }",
  "  [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];",
  "  render([i + 1, high], [], {low, high, pivotIndex: high}, true, `Swap pivot ${arr[i + 1]} to position ${i + 1}`);",
  "  await sleep();",
  "  return i + 1;",
  "}"
];

let array = [], states = [], stateIdx = 0, animating = false, paused = false, timeoutID = null;
const arrayContainer = document.getElementById('array');
const sizeSlider = document.getElementById('sizeSlider');
const speedSlider = document.getElementById('speedSlider');
const codearea = document.getElementById('codearea');
const explanationBox = document.getElementById('explanation');

function randomArray(size) {
  return Array.from({length: size}, () => Math.floor(Math.random() * 180) + 40);
}

function renderArray(comparing = [], sorted = [], pointerIndices = {}, swapping = false, desc = '') {
  arrayContainer.innerHTML = '';
  array.forEach((val, idx) => {
    const bar = document.createElement('div');
    bar.className = 'bar';

    bar.style.height = val + 'px';

    // Pointers low, high, pivot and current: curr = current j accessing array
    let pointerLabels = [];
    if (pointerIndices.low === idx) pointerLabels.push('<span class="low">low</span>');
    if (pointerIndices.high === idx) pointerLabels.push('<span class="high">high</span>');
    if (pointerIndices.pivotIndex === idx) pointerLabels.push('<span class="pivot">pivot</span>');
    if (pointerIndices.curr === idx) pointerLabels.push('<span class="curr">curr</span>');

    if (pointerLabels.length) {
      const pointersDiv = document.createElement('div');
      pointersDiv.className = 'pointers';
      pointersDiv.innerHTML = pointerLabels.join(' ');
      bar.appendChild(pointersDiv);
    }

    bar.innerHTML += `<div class="value">${val}</div>`;

    if (comparing && comparing.includes(idx)) bar.classList.add('comparing');
    if (swapping && comparing && comparing.includes(idx)) bar.classList.add('swapping');
    if (sorted && sorted.includes(idx)) bar.classList.add('sorted');

    arrayContainer.appendChild(bar);
  });
  explanationBox.textContent = desc || '';
}

function snapshot(arr, comparing = [], sorted = [], pointerIndices = {}, swapping = false, desc = '') {
  states.push({
    arr: arr.slice(),
    comparing: comparing.slice(),
    sorted: sorted.slice(),
    pointerIndices: { ...pointerIndices },
    swapping,
    desc,
  });
}

async function partition(arr, low, high, render, sleep) {
  let pivot = arr[high];
  let i = low - 1;
  for (let j = low; j < high; j++) {
    render([j], [], { low, high, pivotIndex: high, curr: j }, false, `Compare ${arr[j]} with pivot ${pivot}`);
    await sleep();
    if (arr[j] <= pivot) {
      i++;
      [arr[i], arr[j]] = [arr[j], arr[i]];
      render([i, j], [], { low, high, pivotIndex: high, curr: j }, true, `Swap ${arr[i]} and ${arr[j]}`);
      await sleep();
    }
  }
  [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
  render([i + 1, high], [], { low, high, pivotIndex: high }, true, `Swap pivot ${arr[i + 1]} to position ${i + 1}`);
  await sleep();
  return i + 1;
}

async function quickSort(arr, low, high, render, sleep) {
  if (low < high) {
    const pi = await partition(arr, low, high, render, sleep);
    await quickSort(arr, low, pi - 1, render, sleep);
    await quickSort(arr, pi + 1, high, render, sleep);
  }
}

async function captureQuickSortSteps() {
  states.length = 0;
  const arrCopy = array.slice();
  async function qs(arr, low, high) {
    if (low < high) {
      snapshot(arr, [], [], { low, high }, false, `Sort between indexes ${low} and ${high}`);
      await new Promise(r => setTimeout(r, 0));
      const pi = await (async () => {
        let pivot = arr[high];
        let i = low - 1;
        for (let j = low; j < high; j++) {
          snapshot(arr, [j], [], { low, high, pivotIndex: high, curr: j }, false, `Compare ${arr[j]} with pivot ${pivot}`);
          await new Promise(r => setTimeout(r, 0));
          if (arr[j] <= pivot) {
            i++;
            [arr[i], arr[j]] = [arr[j], arr[i]];
            snapshot(arr, [i, j], [], { low, high, pivotIndex: high, curr: j }, true, `Swap ${arr[i]} and ${arr[j]}`);
            await new Promise(r => setTimeout(r, 0));
          }
        }
        [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
        snapshot(arr, [i + 1, high], [], { low, high, pivotIndex: high }, true, `Swap pivot ${arr[i + 1]} to position ${i + 1}`);
        await new Promise(r => setTimeout(r, 0));
        return i + 1;
      })();
      await qs(arr, low, pi - 1);
      await qs(arr, pi + 1, high);
    }
  }
  await qs(arrCopy, 0, arrCopy.length - 1);
}

function resetArray() {
  if (animating) return;
  array = randomArray(Number(sizeSlider.value));
  renderArray();
  displayCode(-1);
  states = [];
  stateIdx = 0;
  explanationBox.textContent = '';
}

function useCustomArray() {
  const val = document.getElementById('arrayInput').value;
  const customArr = val.split(',').map(s => +s.trim()).filter(x => !isNaN(x));
  if (customArr.length < 2) {
    alert('Please enter at least 2 numbers, comma separated.');
    return;
  }
  array = customArr;
  renderArray();
  displayCode(-1);
  states = [];
  stateIdx = 0;
  explanationBox.textContent = '';
}

async function start() {
  if (animating) return;
  animating = true;
  paused = false;
  states = [];
  stateIdx = 0;
  await captureQuickSortSteps();
  stateIdx = 0;
  nextStep();
}

function pause() {
  paused = true;
  animating = false;
  if (timeoutID) clearTimeout(timeoutID);
}

function nextStep() {
  if (stateIdx >= states.length) {
    animating = false;
    displayCode(-1);
    explanationBox.textContent = "";
    return;
  }
  const s = states[stateIdx];
  array = s.arr.slice();
  renderArray(s.comparing, s.sorted, s.pointerIndices || {}, s.swapping, s.desc);
  displayCode(s.code ?? -1);
  explanationBox.textContent = s.desc || "";
  stateIdx++;
  if (animating && !paused) {
    timeoutID = setTimeout(nextStep, 640 - Number(speedSlider.value));
  }
}

function prevStep() {
  if (stateIdx > 1) stateIdx -= 2;
  if (states.length) nextStep();
}

function displayCode(hl) {
  codearea.innerHTML = '';
  codeLines.forEach((l, i) => {
    const el = document.createElement('span');
    el.className = 'codeline' + (i === hl ? ' highlight' : '');
    el.textContent = l;
    codearea.appendChild(el);
    codearea.appendChild(document.createTextNode('\n'));
  });
}

sizeSlider.addEventListener('input', resetArray);

resetArray();

// const codeLines = [
//   "async function quickSort(arr, low, high, render, sleep) {",
//   "  if (low < high) {",
//   "    let pi = await partition(arr, low, high, render, sleep);",
//   "    await quickSort(arr, low, pi - 1, render, sleep);",
//   "    await quickSort(arr, pi + 1, high, render, sleep);",
//   "  }",
//   "}",
//   "async function partition(arr, low, high, render, sleep) {",
//   "  let pivot = arr[high];",
//   "  let i = low - 1;",
//   "  for (let j = low; j < high; j++) {",
//   "    render([j], [], {low, high, pivotIndex: high, curr: j}, false, `Compare ${arr[j]} with pivot ${pivot}`);",
//   "    await sleep();",
//   "    if (arr[j] <= pivot) {",
//   "      i++;",
//   "      [arr[i], arr[j]] = [arr[j], arr[i]];",
//   "      render([i, j], [], {low, high, pivotIndex: high, curr: j}, true, `Swap ${arr[i]} and ${arr[j]}`);",
//   "      await sleep();",
//   "    }",
//   "  }",
//   "  [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];",
//   "  render([i + 1, high], [], {low, high, pivotIndex: high}, true, `Swap pivot ${arr[i + 1]} to position ${i + 1}`);",
//   "  await sleep();",
//   "  return i + 1;",
//   "}"
// ];
</script>
</body>
</html>
